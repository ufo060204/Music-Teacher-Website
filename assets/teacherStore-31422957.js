import{d}from"./pinia-ef994b1a.js";import{g as m,a as f,o as D,f as h,h as n,d as l,s as u,u as g,b as p,S as r}from"./sweetalert2.all-09c79ce8.js";import{b as w}from"./index.esm2017-717e340d.js";const o=m(),b=d("teacherStore",{state:()=>({teacherData:{courseId:"",name:"",price:0,type:"",time:0,classMode:[],location:"",startTime:0,courseIntro:"",courseImg:"",teacherImg:"",buyer:[]},teacherUid:""}),actions:{getUid(){const e=f();D(e,t=>{this.teacherUid=t.uid})},async createCourseConnect(){this.getUid(),this.teacherData.price=Number(this.teacherData.price),this.teacherData.time=Number(this.teacherData.time),this.teacherData.startTime=Date.now();try{const e=await h(n(o,"AllCourses"),this.teacherData),t=l(o,"AllCourses",e.id),a=l(o,"users",this.teacherUid);await u(t,{courseId:e.id},{merge:!0}),await u(t,{teacherId:a},{merge:!0}),await g(a,{courses_created:p(t)},{merge:!0}),this.teacherData.courseId="",this.teacherData.name="",this.teacherData.price=0,this.teacherData.type="",this.teacherData.time=0,this.teacherData.classMode=[],this.teacherData.location="",this.teacherData.courseIntro="",this.teacherData.courseImg="",this.teacherData.teacherImg="",r.fire({icon:"success",title:"新課程創建成功",showConfirmButton:!1,timer:1500}),w.push("/teacher/stepFour")}catch(e){r.fire({icon:"error",title:`新課程創建失敗 ${e}`})}},async setCourseData(){try{await h(n(o,"AllCourses"),this.teacherData),r.fire({icon:"success",title:"課程新增成功",showConfirmButton:!1,timer:1500})}catch{r.fire({icon:"error",title:"課程新增失敗",showConfirmButton:!1,timer:1500})}},async updateImg(e,t){try{const a=t.target.files[0];if(!a||!(await this.beforeUpdate(a)).isValid)return;this.imgHandle(e,a)}catch(a){console.log(a)}finally{t.target.value=null}},beforeUpdate(e){return new Promise(t=>{const s=["image/jpeg","image/png"].includes(e.type),i=e.size/1024/1024<.15;s?i||r.fire({icon:"error",title:"尺寸錯誤",text:"圖片大小需小於 0.15 MB"}):r.fire({icon:"error",title:"格式錯誤",text:"請上傳 JPG 或 PNG 檔"}),t({isValid:s&&i})})},imgHandle(e,t){const a=new FormData;a.append("photoFile",t);const s=a.get("photoFile"),i=new FileReader;i.readAsDataURL(s),i.onload=c=>{e==="course"?this.teacherData.courseImg=c.target.result:e==="teacher"&&(this.teacherData.teacherImg=c.target.result)}}}});export{b as t};
