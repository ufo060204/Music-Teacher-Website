import{d as f}from"./pinia-ef994b1a.js";import{S as u}from"./userStore-b1357f2c.js";import{g as A,n as d,h as g,e as h,d as m,u as y}from"./index.browser.esm2017-325a5742.js";import{t as I}from"./teacherStore-1a36b642.js";const i=A(),p=I(),D=u.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",u.stopTimer),e.addEventListener("mouseleave",u.resumeTimer)}}),L=f("coursesStore",{state:()=>({isLoading:!0,AllCourseData:[],teacherNames:{},courseDetails:{data:{}},courseViewDetails:{data:{buyer:[],classMode:[],courseId:"",courseImg:"",courseIntro:"",location:"",name:"",price:0,startTime:0,teacherId:{},teacherImg:"",time:0,type:""},teacherImg:"",teacherName:"",teacherUid:""},popularCourses:[]}),actions:{async getAllCourses(){const e=await d(g(i,"AllCourses"));this.AllCourseData=[],console.log("querySnapshot,",e),e.forEach(t=>{console.log(t.id," => ",t.data());const o={id:t.id,createdTime:t._document.createTime.timestamp.seconds,data:t.data()};this.AllCourseData.push(o)}),console.log("所有課程資料",this.AllCourseData)},async getAllCoursesAndTeacher(){this.isLoading=!0,this.AllCourseData=[];const e=await d(g(i,"AllCourses")),t=[];e.forEach(o=>{const s=o.data();console.log("這是courseData",s);const c=s.teacherId;console.log("這是teacherId",c);const a=h(c).then(r=>{if(r.exists()){const l=r.data().displayName;s.teacherName=l,this.teacherNames[s.teacherId]=l}else console.log(`Teacher document not found for ${s.teacherId}`)}).catch(r=>{console.error("Error fetching teacher document:",r)});t.push(a);const n={id:o.courseId,data:s};this.AllCourseData.push(n)}),await Promise.all(t),console.log("所有課程數據",this.AllCourseData),console.log("老師名稱",this.teacherNames),this.isLoading=!1},getBuyerCount(e){return e.data.buyer.length},async getTopTenCourses(){await this.getAllCoursesAndTeacher(),console.log("篩選前",this.AllCourseData[0])},async getPopularCourses(){this.popularCourses=[],await this.getAllCoursesAndTeacher(),console.log("排序前数据",this.AllCourseData.map(e=>e.data.buyer.length)),this.AllCourseData.sort((e,t)=>t.data.buyer.length-e.data.buyer.length),console.log("排序后数据",this.AllCourseData.map(e=>e.data.buyer.length)),this.popularCourses=this.AllCourseData.slice(0,10),console.log("暢銷課程前 10 名",this.popularCourses)},async getCourseDetails(e){this.isLoading=!0;const t=m(i,"AllCourses",e),o=await h(t);if(console.log("store的",o),console.log("store的courseId",e),o.exists()){const s=o.data(),c=s.teacherId,a=await h(c);if(a.exists()){const n=a.data().displayName,r=a.data().userIntro,l=a.data().userPhoto,C=a.data().uid;this.courseDetails={data:s,teacherName:n,teacherIntro:r,teacherImg:l,teacherUid:C},this.courseViewDetails=JSON.parse(JSON.stringify(this.courseDetails))}else console.log(`Teacher document not found for ${c.path}`)}else console.log(`Course document not found for ${e}`);console.log("單一課程資料",this.courseDetails),this.isLoading=!1},async updateCourseData(e){this.courseDetails.data.courseImg=p.teacherData.courseImg,await y(m(i,"AllCourses",e),this.courseDetails.data);try{p.teacherData.courseImg="",console.log("課程資料更新成功"),this.getCourseDetails(e),D.fire({icon:"success",title:"課程資料更新成功"})}catch(t){console.log("課程資料更新失敗",t),D.fire({icon:"error",title:"課程資料更新失敗"})}}},getters:{}});export{L as c};
