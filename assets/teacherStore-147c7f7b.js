import{d as u}from"./pinia-ef994b1a.js";import{g as d,a as g,o as D,f as c,h,d as i,k as l,u as m,b as p}from"./index.browser.esm2017-ac27ce2e.js";import{a as f}from"./index.esm2017-880666f6.js";const r=d(),w=u("teacherStore",{state:()=>({teacherData:{courseId:"",name:"",price:0,type:"",time:0,classMode:[],location:"",startTime:0,courseIntro:"",courseImg:"",teacherImg:"",buyer:[]},teacherUid:""}),actions:{getUid(){const e=g();D(e,t=>{console.log(t),this.teacherUid=t.uid,console.log("這是 teacherUid",this.teacherUid)})},async createCourseConnect(){this.getUid(),this.teacherData.price=Number(this.teacherData.price),this.teacherData.time=Number(this.teacherData.time),this.teacherData.startTime=Date.now();try{const e=await c(h(r,"AllCourses"),this.teacherData);console.log("這是要送出的課程檔案",this.teacherData);const t=i(r,"AllCourses",e.id);console.log("創建新課程關聯",t);const a=i(r,"users",this.teacherUid);console.log("課程老師uid - teacherUid",this.teacherUid),await l(t,{courseId:e.id},{merge:!0}),await l(t,{teacherId:a},{merge:!0}),await m(a,{courses_created:p(t)},{merge:!0}),this.teacherData.courseId="",this.teacherData.name="",this.teacherData.price=0,this.teacherData.type="",this.teacherData.time=0,this.teacherData.classMode=[],this.teacherData.location="",this.teacherData.courseIntro="",this.teacherData.courseImg="",this.teacherData.teacherImg="",console.log("新課程創建成功"),alert("新課程創建成功"),f.push("/teacher/stepFour")}catch(e){console.error("Error adding course: ",e)}},async setCourseData(){try{console.log("這是要建立的課程資料",this.teacherData),await c(h(r,"AllCourses"),this.teacherData),alert("課程新增成功")}catch(e){alert("課程新增失敗",e)}},async updateImg(e,t){try{const a=t.target.files[0];if(!a)return;this.imgHandle(e,a)}catch(a){console.log(a)}finally{t.target.value=null}},beforeUpdate(){console.log("確認這是圖片檔案")},imgHandle(e,t){const a=new FormData;a.append("photoFile",t);const n=a.get("photoFile"),o=new FileReader;o.readAsDataURL(n),o.onload=s=>{e==="course"?(this.teacherData.courseImg=s.target.result,console.log("課程圖片連結",this.teacherData.courseImg)):e==="teacher"&&(this.teacherData.teacherImg=s.target.result,console.log("老師圖片連結",this.teacherData.teacherImg))}}}});export{w as t};
