import{d as C,a as w,m as T}from"./pinia-ef994b1a.js";import{g as $,d as x,e as D,h as S,n as H,q as N,w as Y}from"./sweetalert2.all-6f07691f.js";import{u as I}from"./userStore-5da9acd5.js";import{b as V}from"./bannerStore-1b7734ea.js";import{L as A}from"./ListPlaceholder-6606d71c.js";import{B as P}from"./BannerArea-ca093728.js";import{bf as q,aC as _,n as o,o as s,v as O,l as M,m as n,ba as j,F as h,aA as p,aq as t,u as F,aQ as i}from"./_plugin-vue_export-helper-ec969899.js";import"./index.esm2017-e9e6cb9c.js";import"./moment-8df7684e.js";const k=$(),B=I(),v=C("orderStore",{state:()=>({myOrders:[],existingOrders:[],isLoading:!0,isBuyHistory:null}),actions:{async getOrders(){this.isLoading=!0,await B.checkMemberObserver();const a=x(k,"users",B.uid),y=await D(a);if(y.exists()){const l=y.data().myOrders;if(l.length===0){console.log("您沒有購買紀錄"),this.isBuyHistory=!1,this.isLoading=!1;return}console.log("使用者的 userOrdersData 內容",l);const f=S(k,"orders"),g=await H(N(f,Y("orderId","in",l))),d=[];g.forEach(async c=>{const e=c.data();d.push(e)}),console.log("存在於 userOrdersData 中的訂單(尚未有課程細節)",d);const u=[];for(const c of d){const e={...c},r=[];await Promise.all(c.orderDetail.map(async m=>{const b=await D(m);b.exists()&&r.push(b.data())})),e.courseDetails=r,u.push(e)}this.myOrders=u,console.log("我的訂單結果",this.myOrders),this.isLoading=!1,this.isBuyHistory=!0}else this.isLoading=!1,console.log("找不到該用戶的文檔")}},getOrderCourseDetails(){},getters:{}}),R={data(){return{}},components:{ListPlaceholderVue:A,BannerArea:P},methods:{...w(v,["getOrders"]),...w(V,["getBannerInfo"])},computed:{...T(v,["myOrders","isLoading","isBuyHistory"])},watch:{},created(){this.getBannerInfo(new URL("/Music-Teacher-Website/title-banner.jpg",self.location).href,"購買紀錄","History","我的紀錄，學習的軌跡"),this.getOrders()}},W={class:"pt-66"},E={class:"container"},Q={key:1,class:"d-flex flex-column justify-content-center align-items-center my-32"},U=s("p",{class:"fs-1 my-16"},"您沒有購買紀錄",-1),z={key:2,class:"card rounded-4 shadow-sm my-32 d-none d-md-block"},G={class:"card-body"},J={class:"table-responsive"},K={class:"table table-hover"},X=s("thead",{class:"border-bottom-3 fw-bold"},[s("tr",{class:"align-middle"},[s("th",{class:"text-nowrap"},"購買時間"),s("th",{class:"text-nowrap"},"購買品項"),s("th",{class:"text-nowrap"},"購買金額")])],-1),Z={class:"text-nowrap"},ss={class:"text-nowrap"},es={key:0,class:"text-nowrap"},ts={key:1,class:"text-nowrap"},os={key:3,class:"accordion my-32 d-md-none",id:"accordionOrder"},as=["id"],rs=["data-bs-target","aria-controls"],ns={class:"d-flex justify-content-between w-100"},is={class:"me-32"},cs={key:0,class:"text-nowrap"},ds={key:1,class:"text-nowrap"},ls=["id","aria-labelledby"],us={class:"accordion-body"};function ms(a,y,L,l,f,g){const d=_("BannerArea"),u=_("ListPlaceholderVue"),c=_("router-link");return t(),o("div",W,[s("div",E,[O(d),a.isLoading?(t(),M(u,{key:0,class:"my-32"})):n("",!0),!a.isLoading&&!a.isBuyHistory?(t(),o("div",Q,[U,O(c,{to:"/courses",class:"btn btn-primary rounded-4"},{default:j(()=>[F("瀏覽課程")]),_:1})])):n("",!0),!a.isLoading&&a.isBuyHistory?(t(),o("div",z,[s("div",G,[s("div",J,[s("table",K,[X,s("tbody",null,[(t(!0),o(h,null,p(a.myOrders,e=>(t(),o("tr",{key:e.orderId},[s("td",Z,i(this.$moment(e.createdTime).format("YYYY年M月D日")),1),s("td",ss,[s("ul",null,[(t(!0),o(h,null,p(e.courseDetails,r=>(t(),o("li",{key:r.courseId},i(r.name),1))),128))])]),e.useCoupon?(t(),o("td",es,"NT$ "+i(e.couponTotal),1)):n("",!0),e.useCoupon?n("",!0):(t(),o("td",ts,"NT$ "+i(e.total),1))]))),128))])])])])])):n("",!0),!a.isLoading&&a.isBuyHistory?(t(),o("div",os,[(t(!0),o(h,null,p(a.myOrders,(e,r)=>(t(),o("div",{key:e.orderId,class:"accordion-item"},[s("h2",{class:"accordion-header",id:"headingOne"+r},[s("button",{class:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse"+r,"aria-expanded":"true","aria-controls":"#collapse"+r},[s("div",ns,[s("p",null,i(this.$moment(e.createdTime).format("YYYY年M月D日")),1),s("p",is,[e.useCoupon?(t(),o("span",cs,"NT$ "+i(e.couponTotal),1)):n("",!0),e.useCoupon?n("",!0):(t(),o("span",ds,"NT$ "+i(e.total),1))])])],8,rs)],8,as),s("div",{id:"collapse"+r,class:"accordion-collapse collapse","aria-labelledby":"headingOne"+r},[s("div",us,[(t(!0),o(h,null,p(e.courseDetails,m=>(t(),o("p",{class:"fw-bold",key:m.courseId},i(m.name),1))),128))])],8,ls)]))),128))])):n("",!0)])])}const Os=q(R,[["render",ms]]);export{Os as default};
