import{d}from"./pinia-ef994b1a.js";import{g,a as m,o as f,f as h,h as n,d as l,s as u,u as D,b as p,S as r}from"./sweetalert2.all-6f07691f.js";import{b as w}from"./index.esm2017-e9e6cb9c.js";const c=g(),U=d("teacherStore",{state:()=>({teacherData:{courseId:"",name:"",price:0,type:"",time:0,classMode:[],location:"",startTime:0,courseIntro:"",courseImg:"",teacherImg:"",buyer:[]},teacherUid:""}),actions:{getUid(){const e=m();f(e,t=>{console.log(t),this.teacherUid=t.uid,console.log("這是 teacherUid",this.teacherUid)})},async createCourseConnect(){this.getUid(),this.teacherData.price=Number(this.teacherData.price),this.teacherData.time=Number(this.teacherData.time),this.teacherData.startTime=Date.now();try{const e=await h(n(c,"AllCourses"),this.teacherData);console.log("這是要送出的課程檔案",this.teacherData);const t=l(c,"AllCourses",e.id);console.log("創建新課程關聯",t);const a=l(c,"users",this.teacherUid);console.log("課程老師uid - teacherUid",this.teacherUid),await u(t,{courseId:e.id},{merge:!0}),await u(t,{teacherId:a},{merge:!0}),await D(a,{courses_created:p(t)},{merge:!0}),this.teacherData.courseId="",this.teacherData.name="",this.teacherData.price=0,this.teacherData.type="",this.teacherData.time=0,this.teacherData.classMode=[],this.teacherData.location="",this.teacherData.courseIntro="",this.teacherData.courseImg="",this.teacherData.teacherImg="",console.log("新課程創建成功"),r.fire({icon:"success",title:"新課程創建成功",showConfirmButton:!1,timer:1500}),w.push("/teacher/stepFour")}catch(e){console.error("Error adding course: ",e),r.fire({icon:"error",title:`新課程創建失敗 ${e}`})}},async setCourseData(){try{console.log("這是要建立的課程資料",this.teacherData),await h(n(c,"AllCourses"),this.teacherData),r.fire({icon:"success",title:"課程新增成功",showConfirmButton:!1,timer:1500})}catch{r.fire({icon:"error",title:"課程新增失敗",showConfirmButton:!1,timer:1500})}},async updateImg(e,t){try{const a=t.target.files[0];if(!a||!(await this.beforeUpdate(a)).isValid)return;this.imgHandle(e,a)}catch(a){console.log(a)}finally{t.target.value=null}},beforeUpdate(e){return new Promise(t=>{const a=["image/jpeg","image/png"];console.log("圖片格式",e.type);const o=a.includes(e.type),s=e.size/1024/1024<.15;o?s||r.fire({icon:"error",title:"尺寸錯誤",text:"圖片大小需小於 0.15 MB"}):r.fire({icon:"error",title:"格式錯誤",text:"請上傳 JPG 或 PNG 檔"}),t({isValid:o&&s})})},imgHandle(e,t){const a=new FormData;a.append("photoFile",t);const o=a.get("photoFile"),s=new FileReader;s.readAsDataURL(o),s.onload=i=>{e==="course"?(this.teacherData.courseImg=i.target.result,console.log("課程圖片連結",this.teacherData.courseImg)):e==="teacher"&&(this.teacherData.teacherImg=i.target.result,console.log("老師圖片連結",this.teacherData.teacherImg))}}}});export{U as t};
